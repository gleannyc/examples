glean: "1.0"
type: model
name: NYC 311
source:
  connectionName: bigquery-template
  sql: >-
    select *, 

    case when extract(dayofweek from created_date) = 1 then 'sunday'

    when extract(dayofweek from created_date) = 2 then 'monday'

    when extract(dayofweek from created_date) = 3 then 'tuesday'

    when extract(dayofweek from created_date) = 4 then 'wednesday'

    when extract(dayofweek from created_date) = 5 then 'thursday'

    when extract(dayofweek from created_date) = 6 then 'friday'

    when extract(dayofweek from created_date) = 7 then 'saturday'

    else null END as day_of_week,

    extract(dayofweek from created_date) as created_day_of_week_numeric,

    extract(day from created_date) as created_day_of_month_numeric,

    extract(month from created_date) as created_month_numeric,

    extract(hour from created_date) as created_hour,

    extract(year from created_date) as created_year,

    if(extract(hour from created_date) in (0,12) and extract(minute from created_date)=0 and extract(second from created_date)=0,true,false) as is_suspicious_timestamp,

    from quickstart.nyc_311
cols:
  - id: created_date
    type: datetime
    physicalName: created_date
    name: created_date
    primaryDate: true
    aggregationOptions:
      minGranularity: second
      maxGranularity: year
  - id: closed_date
    type: datetime
    physicalName: closed_date
    name: closed_date
    primaryDate: false
    aggregationOptions:
      minGranularity: second
      maxGranularity: year
  - id: resolution_action_updated_date
    type: datetime
    physicalName: resolution_action_updated_date
    name: resolution_action_updated_date
    primaryDate: false
    aggregationOptions:
      minGranularity: second
      maxGranularity: year
  - id: is_suspicious_timestamp
    type: attribute
    physicalName: is_suspicious_timestamp
    name: is_suspicious_timestamp
  - id: day_of_week
    type: attribute
    physicalName: day_of_week
    name: day_of_week
  - id: created_day_of_week_numeric
    type: attribute
    physicalName: created_day_of_week_numeric
    name: created_day_of_week_numeric
  - id: agency_name
    type: attribute
    physicalName: agency_name
    name: agency_name
  - id: x_coordinate
    type: attribute
    physicalName: x_coordinate
    name: x_coordinate
  - id: bbl
    type: attribute
    physicalName: bbl
    name: bbl
  - id: latitude
    type: attribute
    physicalName: latitude
    name: latitude
  - id: created_hour
    type: attribute
    physicalName: created_hour
    name: created_hour
  - id: longitude
    type: attribute
    physicalName: longitude
    name: longitude
  - id: created_day_of_month_numeric
    type: attribute
    physicalName: created_day_of_month_numeric
    name: created_day_of_month_numeric
  - id: created_month_numeric
    type: attribute
    physicalName: created_month_numeric
    name: created_month_numeric
  - id: created_year
    type: attribute
    physicalName: created_year
    name: created year
  - id: incident_zip
    type: attribute
    physicalName: incident_zip
    name: incident_zip
  - id: close_time_days
    type: attribute
    physicalName: close_time_days
    name: close_time_days
  - id: row_count
    type: metric
    name: call volume
    aggregate: row_count
  - id: avg_close_time_days
    type: metric
    name: avg days to close
    aggregate: avg
    physicalName: close_time_days
